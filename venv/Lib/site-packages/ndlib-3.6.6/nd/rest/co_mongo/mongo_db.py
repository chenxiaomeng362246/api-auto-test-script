# coding=utf-8
from flask import Flask
from flask.ext.mongoalchemy import MongoAlchemy
from mongoalchemy.document import Document
from mongoalchemy.fields import StringField

from mongoalchemy.session import Session

__author__ = 'linzh'


class MongoDb(object):
    def __init__(self, db, conn_str):
        self.session = Session.connect(db, host=conn_str)

    def get_conn(self):
        return self.session


if __name__ == "__main__":
    db = "py_tests"
    conn_str = "mongodb://qa_mdb_test111:A3aG1i2u85Z4@m3.all.debug.mongod.sdp:34001,m2.all.debug.mongod.sdp:34001,m1.all.debug.mongod.sdp:34001/qa_mdb_test111"
    mongo_o = MongoDb(db, conn_str)

    class Case(Document):
        name = StringField()

    case = Case(name="linzh20190515")

    sess = mongo_o.get_conn()
    sess.save(case)

    sess.flush()

    app = Flask(__name__)
    app.config['STATISMG_DATABASE'] = "qa_mdb_test111"
    app.config['STATISMG_CONNECTION_STRING'] = 'mongodb://qa_mdb_test111:A3aG1i2u85Z4@m1.all.debug.mongod.sdp:34001,m3.all.debug.mongod.sdp:34001,m2.all.debug.mongod.sdp:34001/qa_mdb_test111'
    statis_db = MongoAlchemy(app, config_prefix='STATISMG')

    class Case(statis_db.Document):
        name = StringField()

    case = Case(name="linzh20190515")
    case.save()

