# cof

cleardo framework

http://www.cleardo.com

一个python的基础框架
----------------------------------
3.6.6版本
1、解决每次有新的私有化环境时需要在nd_uc_new.py中配置host的问题
2、更新后所有的配置中.ini 中配置和，和http.py中使用
----------------------------------
3.6.5版本
1、nd_uc_new的NdBts增加vod_pre、eduyun模块
----------------------------------
3.6.3版本
1、替换 http_cs 文件
----------------------------------
3.6.02版本
1、nd_uc_new UcEnv.eduyun环境开启ssl
----------------------------------
3.6.01版本
1、nd_uc_new 补充缺少的 aws=3 配置
----------------------------------
3.6.0版本
1、nd_uc_new 中增加 eduyun =12 的配置（x云平台私有化）
----------------------------------
3.5.91版本
1、注释无用代码
----------------------------------
3.5.9版本
1、使用jar封装的 cs jdk 获取 cs token 并上传文件
2、测试报告显示运行环境
----------------------------------
3.5.8版本
1、nd_uc_new 中增加 void_pre=11的配置
----------------------------------
3.5.7版本
1、将推送本地报告到监控平台的代码剥离，运行顺序提前，并做异常捕获，不影响后续流程
新增co_sender_to_mot.py, 修改runner.py, co_sender.py
----------------------------------
3.5.6版本
1、同3.5.5版本
----------------------------------
3.5.5版本 
1、增加报告上传cs接口总返回data的处理，解决因参数不存在引发的异常
2、修改的文件：\nd\rest\co_test\msg.py
----------------------------------
3.5.4版本 
1、新增巴林环境的UC1.1 BTS域名
----------------------------------
3.5.3版本
1、修复配置文件没有传org为None执行中断问题
----------------------------------
3.5.2版本
1、优化uc目录下token.py文件，判断工程根目录方法
2、优化lib包版本号判断，去掉pycurl依赖
----------------------------------
3.5.1版本
推送报错消息高亮显示为红色
----------------------------------
3.5.0版本
修复旧的uc1.1鉴权tok.py，host没有去掉http协议字符串
----------------------------------
3.3.99版本
更新nd_uc_new.py中get_sorted_header_values方法强制转换hearder的值为字符串，避免有数字
----------------------------------
3.3.98版本
更新nd.rest.http.py,连接错误重试时新建连接
----------------------------------
3.3.97版本
增加多种鉴权方式统一调用类
----------------------------------
3.3.96版本
修复bts美国和香港环境地址为无锡环境地址
----------------------------------
3.3.95版本
修复bts鉴权不支持biz-type和org开通方式的问题
----------------------------------
3.3.93版本
bts鉴权增加判断是否已经获取了token，不用每次接口请求都去申请bts token
----------------------------------
3.3.92版本
bts增加判断是不是https协议
----------------------------------
3.3.91版本
优化bts登陆
----------------------------------
3.3.90版本
优化uc1.1登陆，新增伊拉克uc地址，以及增加可以自定义输入uc地址功能
----------------------------------
3.3.89版本
更新setup.py的依赖安装包更精确
----------------------------------
3.3.88版本
1、nd_uc_new.py 新增bts登录和令牌获取方法
----------------------------------
3.3.87版本
1、删除rest/conf/conf.py中错误的set方法
2、修改http_cs.py 满足cs的qa使用
----------------------------------
3.3.86版本
1、恢复原来判断uc token已使用5天，执行退出操作，避免目前每次校验令牌，刚刚好卡在失效时间点请求接口，提示令牌失效问题
----------------------------------
3.3.85版本
1、修改mongo.py文件中没有MongoFake类
----------------------------------
3.3.84版本
1、修改send_mot方法中接口参数为testRuleId
----------------------------------
3.3.83版本
1、优化uctoken获取机制，只判断令牌是否有效，无效则重新获取，去掉原来的时间判断
2、优化发送cs报告不在每次新申请一个bearer_token
----------------------------------
3.3.82版本
1、更新 nd\rest\co_test\co_sender.py 增加重试和ip配置
----------------------------------
3.3.81版本
1、更新 nd\rest\co_test\runner.py 新增线上监控平台调用参数 --rule
2、更新 nd\rest\co_test\co_sender.py 修改 sender_mot 方法
3、更新 nd\rest\co_test\co_report.py 新增 rule_id 和 对应的set方法
----------------------------------
3.3.72版本
1、优化http请求获取的port为字符串时，转为整型
----------------------------------
3.3.71版本
1、更新 HTMLTestRunner_SAL.py 模块，增加英文报告模板代码
2、重写 nd\rest\co_test\msg.py 的 get_result 方法（保留get_result，新增 get_result_1）,重新处理99u消息中的报告汇总数据
----------------------------------
3.3.67版本
1、nd.rest.uc.mac.v1_1.tok 增加接口请求打印和去掉每次调用都获取一次session
----------------------------------
3.3.60版本
1、增加nd.rest.nd_uc_new.py 新版uc登录和令牌计算
----------------------------------
3.3.40版本
1、增加识别pycurl没有安装，自动安装
----------------------------------
3.3.16版本
1、判断接口返回值中是否含有特殊编码，若有则不输出到报告，并给出编码异常的提示。
----------------------------------
3.3.15版本
1、针对socket的域名解析[Errno 11004]错误，增加重试一次请求机制
----------------------------------
3.3.14版本
1、修复打印接口请求数据时，没有转义特殊字符，导致没转义特殊字符后面的用例结果，html样式异常问题
2、修复windows系统下运行路径包含中文不能执行问题
3、优化实际返回数据的打印，在返回数据不是json，可能是html文件数据时，强制转义特殊字符后打印输出
----------------------------------
3.3.13版本
1、修复没有退出token导致线上uc环境redis存储空间不足问题，增加每次请求前判断token或者bearer_token是否过期，过期则重新获取，否则使用保存的token
----------------------------------
3.3.12版本
1、修复testcases目录的测试文件里，如果类不是继承unittest.TestCase，在runner执行时，测试集TestSuite中会存在空列表，导致脚本分级功能失效问题
----------------------------------
3.3.11版本
1、针对服务端的[Errno 10060]错误，增加重试一次请求机制
----------------------------------
3.3.10版本
1、取消发送日志到日志服务器，避免日志服务器服务挂掉后，工程执行中断
2、测试报告中增加setUpClass出错时，记录执行文件路径处理
3、每次执行用例获取结果数据后，释放缓冲区，修复因为setUpClass初始化出错时，前一个文件执行成功的数据被记录到setUpClass出错的用例中问题
4、使用python计算uc密码的md5加密，不在使用jar计算
5、辅助开发过滤掉框架发起的测试请求的标识改为ApiAutotest
----------------------------------
3.3.9版本
1、优化mongo库的数据存储，不再存储测试集的数据到mongo库的suites表
----------------------------------
3.3.8版本
1、优化restful断言文件，与线上监控平台的restful文件兼容
2、新增生成指定长度的随机大写字母字符串和所有字母字符串的方法
3、请求头增加Qa-Tag标识，辅助开发过滤掉框架发起的测试请求
4、新增香港的uc请求地址
----------------------------------
3.3.7版本
1、新增接口响应时长超过60s后自动断开功能
----------------------------------
3.3.6版本
1、修复使用uc1.0登陆提示“Session未创建或已过期”问题
----------------------------------
3.3.5版本
1、优化对uc1.0的支持
----------------------------------
3.3.4版本
1、增加uc对陕西网教通（snwjt）支持
----------------------------------
3.3.3版本
1、增加对uc1.0鉴权支持
----------------------------------
3.3.2版本
1、restful.py的parse_response函数增加兼容，有默认message信息
----------------------------------
3.3.1版本
1、使用cs新上传域名"uploadcs.101.com"有高概率故障，先改回"cs.101.com"
----------------------------------
3.3.0版本
1、去除将接口调用信息发送给plot.qa.sdp.nd服务的请求。
2、增加对脚本第三层的路径支持。
----------------------------------
3.2.0版本
1、兼容监控平台运行、报告推送需求，增加对-p命令行参数的支持。
----------------------------------
3.1.7版本
1、去除了监控平台未统一触发拨测时，将报告推送至监控平台的操作。
----------------------------------
3.1.6版本
1、测试报告中增加了测试集名称的显示。
----------------------------------
3.1.5版本
1、修复了setup或teardown中有断言失败时无法生成报告的bug。
----------------------------------
3.1.4版本
1、在rest下增加了两个公共文件：http_mot.py、mactokenutil.py
----------------------------------
3.1.3版本
1、修复返回值含有特殊编码数据时，无法生成报告的bug。
2、加长了报告上传cs的session有效时间，为50min。
----------------------------------
3.1.2版本
1、屏蔽向接口监控平台发报告的语句。
----------------------------------
3.1.1版本
1、修复了解析接口响应数据时，打印内容为空的bug。
----------------------------------
3.1.0版本
1、与接口监控平台特性做了合并。向下兼容。
----------------------------------
3.0.12版本
1、增加WJT环境的UC配置，支持大教育独立部署环境的测试
----------------------------------
3.0.11版本
1、在请求headers的User-Agent中，拼接“ApiAutotest”，以标志是接口测试发出的请求
2、优化restful解析，在状态码不符合期望时，打印所有请求、响应信息
3、优化token生成：
① 避免同账号在token有效期内多次登录
② 增加新的多账号切换机制
----------------------------------
3.0.10版本
1、支持在推送群时@contact内指定的人员
2、增加对uc token的性能优化（自测中）
----------------------------------
3.0.9.1版本
1、支持通过配置指定运行测试用例的层级
----------------------------------
3.0.8版本
1、修复SLA服务器异常后，测试中断问题
----------------------------------
3.0.7版本
1、修复SLA获取不到接口用例执行时间问题
2、增加title字段内容的接口测试信息入库
----------------------------------
3.0.6版本
1、修复获取bearer token时，查找不到md5.jar加密包问题
2、修复返回的错误数据中存在"detail"键时，其值为None，导致解析返回数据失败的问题
----------------------------------
3.0.5版本
1、修复用例没有描述，导致报告生成出错问题，用例描述获取新增异常抛出处理
2、修复使用unittest框架后，只配置用例文件目录，不运行目录下test*.py文件问题
3、修复setUpClass初始化失败，中断工程运行问题，针对运行结果输出部分新增异常抛出处理
----------------------------------
3.0.4版本
1、	去除对nose框架的依赖，并更改用例运行时间计算实现，修复最后一个用例运行时间的错误。
2、	修复了测试结果中失败数为0时，未发送报告给接口监控平台的问题。
----------------------------------
3.0.3版本
1、接口测试集配置中新增proid参数，支持测试报告发送到SLA监控平台
----------------------------------
3.0.2版本
1、预生产环境的资源已被sdp回收，改用测试环境请求js和css地址
----------------------------------
3.0.1版本
1、报告标题时间格式显示，导致标题中途换行问题修复
2、java 加密token的地址加上双引号，解决有电脑出现没有双引号，执行出错问题
3、开发预测试新增用例数、成功数和报告地址数据存储到mongo中
----------------------------------
3.0版本优化点：
1、将测试报告改为HTML格式，修复chrom浏览器无法解析问题，修改文件template.py
2、测试用例中的特殊字符转义为html可识别的转义字符，如&转义为&amp;  修改文件report.py
3、http重发次数增加变量，可定制重发次数、restful的parse_response新增detail信息返回
4、ndlib安装新增mongo模块安装
5、runner推送策略优化，开启线上监控，除了没有失败次数，其他情况都发送报告、
6、runner消息推送格式优化成小卡片形式
7、token使用ndlib下jlibs目录的token.jar
8、nd_path.py文件新增获取工程目录接口
9、conf文件新增路径传入参数，完善nd引用分离后，nd不能获取工程目录问题
10、runner的run新增路径传入参数，完善nd引用分离后，nd不能获取工程目录问题
11、优化其他文件使用db_info.py文件的mongo信息连接mongo失败后，终止工程执行问题，提高容错性