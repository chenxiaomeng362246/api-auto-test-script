# coding=utf-8
from ..co_test.co_config import CoConfig
from ..co_test.co_send_strategy import CoSendStrategy
from ..nd_im.new import SendNew99U
import logging
import urllib2
import json
import socket
import os
import requests
from hamcrest import *

__author__ = 'linzh'

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

__author__ = 'linzh'


class CoSender(object):
    """
    报告发送
    """

    def __init__(self, strategy=CoSendStrategy(), config=CoConfig()):
        self.strategy = strategy
        self.config = config

    def set_strategy(self, s):
        self.strategy = s

    def send(self, res):
        self.strategy.report.set_fail(res['failed'])

        logger.info("推送99u")
        if self.strategy.to_send():
            logger.info("策略：允许消息推送")
            sender_o = SendNew99U()
            receivers = self.config.receivers
            group = self.config.group

            if len(receivers):
                if receivers is not None:
                    print "推送人："
                    print receivers
                    sender_o.send_to_receivers_in_box(res, receivers, 1)

            if len(group):
                if group is not None:
                    print "推送群："
                    print group
                    sender_o.send_to_receivers_in_box(res, group, 2, self.config.contact)
